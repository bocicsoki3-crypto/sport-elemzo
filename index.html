// JAV√çTOTT F√úGGV√âNY: Illeszd be ezt a k√≥d.gs f√°jlba a r√©gi buildClassicAnalysisHtml hely√©re!
function buildClassicAnalysisHtml(sim, markets, analysisTexts, matchData, odds, sport) {
    // Kezdj√ºk a metrik√°k renderel√©s√©vel, ahogy eddig is
    let html = renderMetrics({
        teams: { home: matchData.home, away: matchData.away },
        xg: { home: matchData.mu_h, away: matchData.mu_a },
        homeRating: matchData.homeRating,
        awayRating: matchData.awayRating,
        sport: sport
    });

    // A piacok bej√°r√°sa az √∫j, frontend √°ltal v√°rt strukt√∫r√°val
    markets.forEach((market) => {
        // A be√©rkez≈ë markdown sz√∂veg √°talak√≠t√°sa HTML-re
        const text = markdownToHtml(analysisTexts[market.id] || "<span class='muted'>Nem √©rkezett sz√∂veges elemz√©s.</span>");
        
        // Speci√°lis "value-bet" kiemel√©s, ha az AI javaslatr√≥l van sz√≥
        const cardClass = market.isHero ? 'analysis-step-card value-bet' : 'analysis-step-card';
        // Ikonok a piacokhoz a l√°tv√°nyoss√°g√©rt
        const icons = { '1x2': 'üèÜ', 'totals': '‚öΩ', 'btts': 'ü•Ö', 'ht_ft': '‚è±Ô∏è', 'best-tip': '‚≠ê', 'synthesis': 'üß†' };
        const icon = icons[market.id] || 'üìä';

        html += `<div class="${cardClass}">`;
        html += `<div class="step-header"><span class="step-icon">${icon}</span><h2 class="step-title">${market.title}</h2></div>`;
        html += `<div class="step-content">${text}`; // A gener√°lt sz√∂veg itt helyezkedik el

        // Val√≥sz√≠n≈±s√©gek √©s odds-ok megjelen√≠t√©se az √∫j st√≠lus szerint
        if (market.id === 'ht_ft' && market.data) {
             html += '<div class="market-options-grid" style="margin-top: 1rem;">';
             market.data.forEach(opt => {
                 html += `<div class="grid-item"><div class="grid-item-label">${escapeHtml(opt.label)}</div><div class="grid-item-value">${opt.value.toFixed(1)}%</div></div>`;
             });
             html += '</div>';
        } else if (market.data && !market.isHero) { // A legjobb tippn√©l nem kell s√°vokat mutatni
            html += '<div style="margin-top: 1rem;">';
            market.data.forEach(opt => {
                const probValue = opt.value;
                let oddsInfo = '';
                if (odds) {
                    let odd = null;
                    if (market.id === '1x2' && odds.h2h) {
                        if (opt.label === 'Hazai') odd = odds.h2h.home;
                        else if (opt.label === 'D√∂ntetlen') odd = odds.h2h.draw;
                        else if (opt.label === 'Vend√©g') odd = odds.h2h.away;
                    } else if (market.id === 'totals' && odds.totals) {
                        if (opt.label.includes('Felett')) odd = odds.totals.over;
                        else if (opt.label.includes('Alatt')) odd = odds.totals.under;
                    } else if (market.id === 'btts' && odds.btts) {
                        if (opt.label === 'Igen') odd = odds.btts.yes;
                        else if (opt.label === 'Nem') odd = odds.btts.no;
                    }
                    if (odd) {
                        const ev = ((probValue / 100) * odd) - 1;
                        oddsInfo = ` / Odds: <b>${odd}</b> / EV: <b style="color:${ev > 0.01 ? '#D4AF37' : '#aaa'};">${ev > 0 ? '+' : ''}${(ev * 100).toFixed(1)}%</b>`;
                    }
                }
                html += `<div class="analysis-option"><div class="option-row"><span class="option-label">${escapeHtml(opt.label)}</span><span class="option-meta">Val√≥sz√≠n≈±s√©g: <b style="color:var(--accent);">${probValue.toFixed(1)}%</b>${oddsInfo}</span></div><div class="option-bar-wrap"><div class="option-bar" style="width:${probValue.toFixed(1)}%;"></div></div></div>`;
            });
            html += '</div>';
        }
        
        html += `</div></div>`; // .step-content √©s .analysis-step-card lez√°r√°sa
    });

    return html;
}
